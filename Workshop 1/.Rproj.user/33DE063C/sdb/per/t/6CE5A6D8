{
    "collab_server" : "",
    "contents" : "# Load libraries\nlibrary(\"knitr\")\noptions(digits=2)\nlibrary(\"rmarkdown\")\nlibrary(\"devtools\")\nlibrary(\"readr\")\nlibrary(\"tidyr\")\nlibrary(\"ggplot2\")\nlibrary(\"ggthemes\")\nlibrary(\"gridExtra\")\nlibrary(\"dplyr\")\nlibrary(\"lubridate\")\nlibrary(\"GGally\")\nlibrary(\"rworldmap\")\nlibrary(\"ggmap\")\nlibrary(\"scales\")\nlibrary(\"dichromat\")\nlibrary(\"RColorBrewer\")\nlibrary(\"viridis\")\nlibrary(\"purrr\")\nlibrary(\"broom\")\nlibrary(\"timeDate\")\nlibrary(\"haven\")\nlibrary(\"boot\")\n\n# Read workers data\nworkers <- read_csv(file=\"data/Assembled_Workers__Compensation_Claims___Beginning_2000.csv\")\n# Instead of table(workers$Gender)\nworkers %>%\n  group_by(Gender) %>%\n  tally()\n# Instead of\n# mean(workers$`Birth Year`, na.rm=TRUE)\n# sd(workers$`Birth Year`, na.rm=TRUE)\nworkers %>%\n  group_by(Gender) %>%\n  filter(Gender %in% c(\"F\", \"M\")) %>%\n  summarise(m=mean(`Birth Year`, na.rm=TRUE),\n            s=sd(`Birth Year`, na.rm=TRUE))\n\n# Grad programs\ngrad <- read_csv(\"data/graduate-programs.csv\")\nhead(grad[c(2,3,4,6)])\n\n# Genes\ngenes <- read_csv(\"data/genes.csv\")\ngenes\n\n# Temperature\nmelbtemp <- read.fwf(\"data/ASN00086282.dly\",\n   c(11, 4, 2, 4, rep(c(5, 1, 1, 1), 31)), fill=T)\nhead(melbtemp[,c(1,2,3,4,seq(5,128,4))])\n\n# TB\ntb <- read_csv(\"data/tb.csv\")\n#tail(tb)\ncolnames(tb)\n\n# Survey\npew <- read.delim(\n  file = \"http://stat405.had.co.nz/data/pew.txt\",\n  header = TRUE,\n  stringsAsFactors = FALSE,\n  check.names = F\n)\npew[1:5, 1:5]\n\n# French fries\ndata(french_fries, package = \"reshape2\")\nhead(french_fries)\nff_long <- gather(french_fries, key = variable, value =\n                    rating, potato:painty)\nhead(ff_long)\nfrench_fries_wide <- spread(ff_long, key = variable,\n                            value = rating)\n\nhead(french_fries_wide)\nff.m <- french_fries %>%\n  gather(type, rating, -subject, -time, -treatment, -rep)\nhead(ff.m)\nggplot(data=ff.m, aes(x=rating)) + geom_histogram(binwidth=2) +\n  facet_wrap(~type, ncol=5)\nggplot(data=ff.m, aes(x=type, y=rating, fill=type)) +\n  geom_boxplot()\nhead(ff.m)\nff.s <- ff.m %>% spread(rep, rating)\nhead(ff.s)\nggplot(data=ff.s, aes(x=`1`, y=`2`)) + geom_point() +\n  theme(aspect.ratio=1) + xlab(\"Rep 1\") + ylab(\"Rep 2\")\nggplot(data=ff.s, aes(x=`1`, y=`2`)) + geom_point() +\n  theme(aspect.ratio=1) + xlab(\"Rep 1\") + ylab(\"Rep 2\") +\n  scale_x_sqrt() + scale_y_sqrt()\n## ggplot(data=ff.s, aes(x=`1`, y=`2`)) + geom_point() +\n##   theme(aspect.ratio=1) +\n##   xlab(\"Rep 1\") + ylab(\"Rep 2\") + facet_wrap(~type, ncol=5)\n## ggplot(data=ff.s, aes(x=`1`, y=`2`)) + geom_point() +\n##   theme(aspect.ratio=1) +\n##   xlab(\"Rep 1\") + ylab(\"Rep 2\") + facet_grid(treatment~type)\n\n# Billboard data\nbillboard <- read.csv(\"data/billboard.csv\")\nlong_billboard <- gather(billboard, key = week, value = rank, X1:X76)\nlong_billboard$week <- as.numeric(gsub(\"X\", \"\", long_billboard$week))\n\nggplot(data = long_billboard, aes(x=week, y=rank, colour = artist, group = track)) + geom_line() + theme(legend.position=\"bottom\")\n\n# Back to french fries\nfrench_fries_split <- group_by(ff_long, variable) # SPLIT\nfrench_fries_apply <- summarise(french_fries_split,\n     rating = mean(rating, na.rm = TRUE)) # APPLY + COMBINE\nfrench_fries_apply\nfrench_fries %>%\n    filter(subject == 3, time == 1)\nfrench_fries %>%\n    arrange(desc(rancid)) %>%\n    head\nfrench_fries %>%\n    select(time, treatment, subject, rep, potato) %>%\n    head\nfrench_fries %>%\n    group_by(time, treatment) %>%\n    summarise(mean_rancid = mean(rancid),\n              sd_rancid = sd(rancid))\nfrench_fries %>%\n  select(subject, time, treatment) %>%\n  tbl_df() %>%\n  count(subject, time) %>%\n  spread(time, n) %>% head\nfrench_fries %>%\n  select(subject, time, treatment) %>%\n  filter(subject==31)\nfrench_fries %>%\n  gather(type, rating, -subject, -time, -treatment, -rep) %>%\n  select(subject, time, treatment, type) %>%\n  tbl_df() %>%\n  count(subject, time) %>%\n  spread(time, n) %>% head\nggplot(data=ff.m, aes(time, rating, colour=treatment)) +\n  geom_point() +\n  facet_grid(subject~type)\nff.m %>% filter((type %in% c(\"buttery\", \"painty\")) & (subject %in% c(\"3\", \"10\"))) %>%\n  ggplot(aes(time, rating, colour=treatment)) +\n  geom_point() +\n  facet_grid(subject~type)\nff.m.av <- ff.m %>%\n  group_by(subject, time, type, treatment) %>%\n  summarise(rating=mean(rating))\nggplot(data=ff.m, aes(time, rating, colour=treatment)) +\n  geom_point() +  facet_grid(subject~type) +\n  geom_line(data=ff.m.av, aes(group=treatment))\nff.m.av <- ff.m %>%\n  filter((type %in% c(\"buttery\", \"painty\")) & (subject %in% c(\"3\", \"10\"))) %>%\n  group_by(subject, time, type, treatment) %>%\n  summarise(rating=mean(rating))\nff.m %>% filter((type %in% c(\"buttery\", \"painty\")) & (subject %in% c(\"3\", \"10\"))) %>%\n  ggplot(aes(time, rating, colour=treatment)) +\n  geom_point() +  facet_grid(subject~type) +\n  geom_line(data=ff.m.av, aes(group=treatment))\n\n# Genes\ngenes <- read_csv(\"data/genes.csv\")\nhead(genes)\ngather(genes, variable, expr, -id) %>% head\ngenes %>%\n  gather(variable, expr, -id) %>%\n  separate(variable, c(\"trt\", \"leftover\"), \"-\") %>%\n  head\ngenes %>%\n  gather(variable, expr, -id) %>%\n  separate(variable, c(\"trt\", \"leftover\"), \"-\") %>%\n  separate(leftover, c(\"time\", \"rep\"), \"\\\\.\") %>% head\ngtidy <- genes %>%\n  gather(variable, expr, -id) %>%\n  separate(variable, c(\"trt\", \"leftover\"), \"-\") %>%\n  separate(leftover, c(\"time\", \"rep\"), \"\\\\.\") %>%\n  mutate(trt = sub(\"W\", \"\", trt)) %>%\n  mutate(rep = sub(\"R\", \"\", rep))\nhead(gtidy)\ngmean <- gtidy %>%\n  group_by(id, trt, time) %>%\n  summarise(expr = mean(expr))\nggplot(data = gtidy, aes(trt, expr, colour = time)) +\n         geom_point() +\n  xlab(\"Type of modification\") + ylab(\"Expression\") +\n  facet_wrap(~id) +\n  geom_line(data = gmean, aes(group = time))\n\n# Temperature\nmelbtemp.m <- melbtemp %>%\n  select(num_range(\"V\", c(1,2,3,4,seq(5,128,4)))) %>%\n  filter(V4 %in% c(\"PRCP\", \"TMAX\", \"TMIN\")) %>%\n  gather(day, value, V5:V125, na.rm = TRUE) %>%\n  spread(V4, value) %>%\n  mutate(\n    tmin = as.numeric(TMIN) / 10,\n    tmax = as.numeric(TMAX) / 10,\n    t_range = tmax - tmin,\n    prcp = as.numeric(PRCP) / 10\n  ) %>%\n  rename(stn=V1, year=V2, month=V3)\nhead(melbtemp.m)\nmelbtemp.m$day <- factor(melbtemp.m$day,\n  levels=c(\"V5\",\"V9\",\"V13\",\"V17\",\"V21\",\"V25\",\"V29\",\n           \"V33\",\"V37\",\"V41\",\"V45\",\"V49\",\"V53\",\"V57\",\n           \"V61\",\"V65\",\"V69\",\"V73\",\"V77\",\"V81\",\"V85\",\n           \"V89\",\"V93\",\"V97\",\"V101\",\"V105\",\"V109\",\n           \"V113\",\"V117\",\"V121\",\"V125\"),\n  labels=1:31)\nmelbtemp.m$date <- as.Date(paste(melbtemp.m$day,\n     melbtemp.m$month, melbtemp.m$year, sep=\"-\"),\n     \"%d-%m-%Y\")\nhead(melbtemp.m)\n\nmelbtemp.m$wday <- wday(melbtemp.m$date, label=TRUE, abbr=TRUE)\n\ntb_tidy <- tb %>%\n  gather(demographic, cases, m_04:f_u, na.rm = TRUE) %>%\n  separate(demographic, c(\"sex\", \"age\"), \"_\") %>%\n  rename(country = iso2) %>%\n  arrange(country, year, sex, age)\nhead(tb_tidy)\n\n# Time\nnow()\ntoday()\nnow() + hours(4)\ntoday() - days(2)\nymd(\"2013-05-14\")\nmdy(\"05/14/2013\")\ndmy(\"14052013\")\nymd_hms(\"2013:05:14 14:5:30\", tz = \"Australia/Melbourne\")\nmonth(ymd(\"2013-05-14\"))\nyear(ymd(\"2013-05-14\"))\nwday(ymd(\"2013-05-14\"), label=TRUE, abbr=TRUE)\nisWeekday(ymd(\"2013-05-14\"))\n\n# Workers\nworkers$`Accident Date` <- as.Date(workers$`Accident Date`,\n                                    format=\"%m/%d/%Y\")\nsummary(workers$`Accident Date`)\nworkers$year <- year(workers$`Accident Date`)\nsummary(workers$year)\nworkers %>% group_by(year) %>% tally() %>% head\nworkers$month <- month(workers$`Accident Date`,\n                       label=TRUE, abbr=TRUE)\nsummary(workers$month)\nworkers$wday <- wday(workers$`Accident Date`,\n                     label=TRUE, abbr=TRUE)\nsummary(workers$wday)\nworkers$timeindx <- as.numeric(workers$`Accident Date`-\n        as.Date(\"01/01/2000\", format=\"%m/%d/%Y\"))\nws <- workers %>% filter(year > 1999)\nggplot(ws, aes(x=year)) + geom_bar()\nggplot(ws, aes(x=month)) + geom_bar()\nws$wday <- factor(ws$wday, levels=levels(ws$wday)[c(2:7,1)])\nggplot(ws, aes(x=wday)) + geom_bar()\nggplot(ws, aes(x=year, fill=`Claim Type`)) + geom_bar()\nws %>% filter(Gender %in% c(\"F\", \"M\")) %>%\n  ggplot(aes(x=year, fill=Gender)) + geom_bar(position=\"fill\")\n",
    "created" : 1463718155497.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3426432468",
    "id" : "6CE5A6D8",
    "lastKnownWriteTime" : 1463724393,
    "last_content_update" : 1463724393975,
    "path" : "~/talks/ISCRR/ISCRR/Workshop 1/3-data-wrangling.R",
    "project_path" : "3-data-wrangling.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}